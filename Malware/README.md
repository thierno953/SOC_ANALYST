# Malware

- Malware is a software intentionally designed to cause damage or gain access to a computer, server, or computer network.

`Malicious + Software = Malware`

- Malware are written by hackers or cyber attacker, or malware authors.

- Everyday around 300k new malware are created and distributed.

## Intentions of Malwares

- Steal sensitive information

- Scamming

- Shutdown services

- Data Breaches

- Install other applications

- Encrypt files

- Execute larger attack

# YARA

- YARA is a powerfull tool used to detect and classify malware by defining patterns.

- YARA (`Yet Another Recursive Acronym`) is a rule-based language used for identifying and classifying malware samples based on patterns.

- **Purpose**: Helps in threat hunting, malware analysis, and incident resposne by detecting specific file signatures and behavioral patterns.

- **Key Features**:
  - Simple and flexible syntax
  - Can scan files, memory, and network traffic.

## Why Use YARA for Malware Detection?

- **Malware Detection**: Identifies malware based on known patterns, strings, and behaviors.
- **Threat Hunting**: Enables proactive searches for new and emerging threats.
- **Scalability**: Works across various platforms, handling large datasets.
- **Use Cases**:
  - Detecting ransomware, trojans, and obfuscated malware.
  - Identifying command-and-control traffic.

## Understanding YARA Rule Structure

- YARA rules are structured using clearly defined sections:

```sh
rule Rule_Name {
  meta:
    author = "Author Name"
    description = "Brief rule description"
    date = "YYYY-MM-DD"
    version = "1.0"

  strings:
    $string1 = "text to match"
    $hex1 = {6A 40 68}
    $regex1 = /[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}/

  condition:
    any of them
}
```

# Sample YARA Rule:

```sh
rule Sample_Malware_Detection {

  meta:
    author = "Your Name"
    description = "Detects a sample malware based on strings and hex patterns."
    date = "2025-03-21"
    version = "1.0"
    reference = "https://malware-analysis-example.com"
    malware_family = "SampleMalware"

  strings:
    $text_string1 = "malicious_function"         // Malicious function name
    $hex_pattern1 = {6A 40 68 00 30 00 00 6A 14}  // Known malware hex pattern
    $regex_pattern1 = /[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}/  // Email pattern
    $url = "http://malicious-website.com"        // C2 URL or malware beacon

  condition:
    any of them
}
```

## Installing YARA on Linux

```sh
sudo apt install yara -y
yara --version
```

## Installing YARA on Windows

- Download from: [https://github.com/virustotal/yara/releases](https://github.com/virustotal/yara/releases)

## Calculating File Hashes

#### Linux

```sh
md5sum suspicious_file.exe
sha1sum suspicious_file.exe
sha256sum suspicious_file.exe
```

#### Windows

```sh
CertUtil -hashfile suspicious_file.exe MD5
CertUtil -hashfile suspicious_file.exe SHA1
CertUtil -hashfile suspicious_file.exe SHA256
```

#### Useful Resources

- HxD Hex Editor [https://mh-nexus.de/en/hxd/](https://mh-nexus.de/en/hxd/)
- EICAR Test File [https://www.eicar.org/download-anti-malware-testfile/#top](https://www.eicar.org/download-anti-malware-testfile/#top)
- HashTab for Windows [https://hashtab.en.softonic.com/](https://hashtab.en.softonic.com/)
- VirusTotal [https://www.virustotal.com/](https://www.virustotal.com/)
- Malware Bazaar [https://bazaar.abuse.ch/](https://bazaar.abuse.ch/)
- Hybrid Analysis [https://www.hybrid-analysis.com/](https://www.hybrid-analysis.com/)
- YARA Rules GitHub Repository [https://github.com/Yara-Rules/rules](https://github.com/Yara-Rules/rules)
