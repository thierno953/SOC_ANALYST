# Detecting Ransomware Encryption Techniques

- Purpose
- Yara Rule
- Sample file

```sh
barry@Thierno:~$ nano task2.yar
```

```sh
rule Ransomware_Encryption {
    strings:
        $encrypt1 = "CreateFileA"
        $encrypt2 = "CryptEncrypt"
    condition:
        any of ($encrypt*)
        // all of ($encrypt1, $encrypt2)
}


# ----------------------


rule Ransomware_Encryption {
    meta:
        description = "Détecte les techniques de chiffrement utilisées par les ransomwares."
        author = "Votre Nom"
        date = "2023-10-25"
    strings:
        $encrypt1 = "CreateFileA"  // Fonction pour ouvrir des fichiers
        $encrypt2 = "CryptEncrypt" // Fonction pour chiffrer des données
    condition:
        all of them  // La condition est remplie si toutes les chaînes sont trouvées
}


# ----------------------


rule Ransomware_Encryption {
    strings:
        $encrypt1 = /CreateFileA|CreateFileW/  // Fonctions pour ouvrir des fichiers
        $encrypt2 = /CryptEncrypt|AES-256-CBC/ // Fonctions et algorithmes de chiffrement
    condition:
        any of them  // La condition est remplie si l'une des chaînes est trouvée
}
```

```sh
barry@Thierno:~$ nano file2.txt
```

```sh
--- BEGIN FILE HEADER ---
File ID: ENC-RANS-2025
Timestamp: 2025-01-12T18:24:15Z
Threat Level: CRITICAL
Status: Encryption in Progress

--- RANSOMWARE LOG ---
Operation Mode: Encrypting File Storage
Encryption Algorithm: AES-256-CBC
Process ID: 9481
Key Generation: Automated

--- MALWARE SEQUENCE ---
Action: CreateFileA
Function: Initialize encryption routine

Sequence:
    - Start by calling the CreateFileA function to open files for encryption
    - Ensure each file is accessible for block encryption

Procedure:
    - Encrypt file content block by block
    - Use the CryptEncrypt function to encrypt each block
    - Save encrypted data back to the file system

--- PAYLOAD DATA ---
Encryption API Calls:
    - CryptAcquireContext
    - CryptGenKey
    - CryptEncrypt (main encryption process)
    - CryptDestroyKey

--- FILE STATUS ---
Total Files Encrypted: 157
Failed Encryptions: 3
File Extensions Targeted: .docx, .xlsx, .pdf, .jpg

--- CHECKSUM DATA ---
Checksum (SHA-256): A7F4BC3A5C3E17D2C82F18F7EE9B7CF2
Verification Status: Not Verified

--- INFECTION SPREAD LOG ---
Spread Type: Local Network
Access: Admin Privileges
Propagation Method: SMB Protocol
```

```sh
barry@Thierno:~$ yara task2.yar file2.txt

barry@Thierno:~$ yara -s task2.yar file2.txt
```

```sh
barry@Thierno:~$ nano ransomware_windows_HDDCryptorA.yar
```

```sh
rule ransomware_windows_HDDCryptorA {
    meta:
        description = "Detects HDDCryptor ransomware"
        author = "@fusionrace"
        date = "2025-01-05"
        severity = "high"
        reference = "http://blog.trendmicro.com/trendlabs-security-intelligence"
        md5 = "d41d8cd98f00b204e9800998ecf8427e"
        sha1 = "da39a3ee5e6b4b0d3255bfef95601890afd80709"
        sha256 = "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"

    strings:
        // Unique strings
        $u1 = "You are Hacked" ascii wide nocase
        $u2 = "Your H.D.D Encrypted, Contact Us For Decryption key" ascii wide nocase
        $u3 = "Start hard drive encryption..." ascii wide nocase
        $u4 = "Your hard drive is securely encrypted" ascii wide nocase

        // Generic strings
        $g1 = "Wide All Passwords?" ascii wide nocase
        $g2 = "SYSTEM\\CurrentControlSet\\Services\\dcrypt\\config" ascii wide nocase
        $g3 = "DiskCryptor" ascii wide nocase
        $g4 = "dcinst.exe" ascii wide nocase
        $g5 = "dcrypt.exe" ascii wide nocase
        $g6 = "you can only use AES to encrypt the boot partition!" ascii wide nocase

    condition:
        (1 of ($u*)) or (2 of ($g*))
}
```

```sh
root@yara:~/task2# nano sample_file.exe
```

```sh
You are Hacked
dcinst.exe
```

```sh
root@yara:~/task2# md5sum sample_file.exe
d41d8cd98f00b204e9800998ecf8427e  sample_file.exe
root@yara:~/task2# sha1sum sample_file.exe
da39a3ee5e6b4b0d3255bfef95601890afd80709  sample_file.exe
root@yara:~/task2# sha256sum sample_file.exe
e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855  sample_file.exe
```

```sh
root@yara:~/task2# yara ransomware_windows_HDDCryptorA.yar sample_file.exe
ransomware_windows_HDDCryptorA sample_file.exe
root@yara:~/task2# yara -s ransomware_windows_HDDCryptorA.yar sample_file.exe
ransomware_windows_HDDCryptorA sample_file.exe
0x0:$u1: You are Hacked
0xf:$g4: dcinst.exe
```
