# Linux Forensics

- Linux forensics is the process of analyzing a Linux-based system to detect, investigate, and respond to security incidents.

#### Objective `Evidence Collection, Incident Detection and Response, Analysis, Documentation and Reporting`

## Types of Evidence

- Live data collection: `EDR (Business)`, `Process (ps, top, htop)`, `Network (netstat, lsof -i)`, `System stack`.

- Memory Dump: `dd, RAM capture, LiME (Linux Memory Extractor)`.

- Disk imaging: `dd`.

- File system analysis: `Metadata (ls -l), deleted files`.

- Log files: `System logs (/var/log), Application logs`.

- Configuration files: `/etc/passwd`.

- User activity: `.bash_history, .zsh_history`.

- Login history: `/var/log/lastlog, /var/log/auth.log`.

- Scheduled tasks: `/etc/, crontab`

## 1 - Analyzing System Logs with journalctl

- `journalctl` is a command-line utility for querying and displaying logs from systemd's journal. It provides a powerful and flexible interface for examining logs generated by various services and the kernel.

```sh
journalctl -n 100
journalctl --since "1 hour ago"
journalctl -u ssh
journalctl | grep "error"
journalctl -b > logs_from_last_boot.txt
```

## 2 - Parsing Log Files with awk

- `awk` is a powerful text-processing language used for data extraction and reporting. It is particularly useful for parsing log files and extracting specific fields or patterns.

```sh
nano /var/log/syslog
awk '{print $1, $2, $3}' /var/log/syslog
awk '/root/ {print $0}' /var/log/syslog
awk '/root/ {count++} END {print count}' /var/log/auth.log
awk '/failed/ {count++} END {print count}' /var/log/auth.log
awk '/session opened/ {user[$11]++} END {for (u in user) print u, user[u]}' /var/log/auth.log
awk '/root/' /var/log/syslog > warning_logs.txt
nano warning_logs.txt
```

## Lab 3: Monitoring Logs in Real-Time with tail

- `tail` is a command-line utility used to display the end of a text file or stream. It is commonly used to monitor log files in real-time.

```sh
tail /var/log/syslog
tail -f /var/log/syslog | grep --color=auto "error"
tail -f /var/log/syslog /var/log/auth.log
tail -n 50 -f /var/log/syslog
```

## Lab 4: Summarizing Logs with logwatch

- `logwatch` is a log analysis tool that generates detailed summaries of system logs. It provides insights into system activity and potential issues by aggregating and summarizing log entries.

```sh
sudo apt-get install logwatch
logwatch --help
sudo logwatch --detail low --range today
```

## Lab 5: Using Auditd to track System Events

- Use `Auditd` to set up and analyze audit rules for tracking specific system events.

```sh
sudo apt-get install auditd
sudo systemctl start auditd
sudo systemctl status auditd
sudo auditctl -w /bin/chmod -p x -k chmod_changes
sudo chmod 755 warning_logs.txt
sudo ausearch -k chmod_changes
```

# Linux File System Analysis

- Linux File System Analysis is the process of examining the structure and content of a Linux file system to uncover, analyze, and interpret digital evidence.

  - To reconstruct events and user activities.

  - To identify security breaches, recover deleted data, and ensure compliance.

  - To gather evidence for legal investigations and incident response.

## File System Analysis Activities

- **Files and directories Analysis** Attributes (`lsattr, chattr`), timestamps (`stat`), hidden files (`ls -a, find / -name ".\*"`)

- **Metadata examination**

- **Content analysis** :

  - Injection detection (`grep`, **YARA**)

  - Malware analysis (ClamAV, VirusTotal, `strings`)

  - AES-256 encrypted data

- **Advanced activities** Data recovery, malware detection

# Linux File System

- A Linux file system is a structured way to store and organize data on a disk drive or other storage devices.

- It manages how data is stored, retrieved, and organized on a storage medium.

#### File System Types: `Ext2, Ext3, Ext4, ReiserFS, XFS, Btrfs, etc`

#### Structure: `Superblock, inode table, data blocks, directories, metadata`

#### Linux Directories: `/home/username`, `/ (root)`, `/etc/network/interfaces`, `/etc/hosts`, `/etc/passwd`, `/etc/shadow`, `/var/log`, `/var/www`

#### Common Tools: `ls` , `stat` , `find`, `grep` , `file` , `df` , `du` , `mount`

#### List directory contents: `ls -l /home ,ls -la /home`

#### Analyze file metadata:

```sh
stat /home/username/file.txt
file /home/username/file.txt
find /home -name "*.txt"
find /home -empty
find /home -type f -size +100M
find /home -type f -mtime -7
find /home -type f -atime -7
find /home -type f -ctime -7
```

#### Analyze disk usage:

```sh
df -h
du -sh /home/username
du -ah /home/username
```

#### Search content in files:

```sh
echo "This is a test file for malware analysis." > test.exe
grep "malware" *.exe
grep -r "malware"
grep -c "malware" *.exe
```
