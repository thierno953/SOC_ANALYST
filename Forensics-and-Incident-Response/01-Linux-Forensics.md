# Linux Forensics

- Linux forensics is the process of analyzing a Linux-based system to detect, investigate, and respond to security incidents.

#### Objective

- Evidence Collection
- Incident Detection and Response
- Analysis
- Documentation and Reporting

#### Types of Evidence

- Live data Collection: (EDR "Business", Process "ps, top, htop", Network "netstat, lsof -i", System Stack)
- Memory Dump: (dd, RAM Dump, LiME "Linux Memory Extractor")
- Disk Imaging: dd
- File System Analysis: Metadata(ls -l), Deleted File
- Log Files: System logs (/var/log), App log
- Configuration Files: /etc/passwd
- User Activity: .bash_history, .zsh_history
- Login Records: /var/log/lastlog, /var/log/auth.log
- Scheduled Tasks: /etc/ , crontab

#### 1 - Analyzing System Logs with journalctl

- Journalctl is a command-line utility for querying and displaying logs from systemd's journal. It provides a powerful and flexible interface for examining logs generated by various services and the kernel.

```sh
journalctl -n 100
journalctl --since "1 hour ago"
journalctl -u ssh
journalctl | grep "error"
journalctl -b > logs_from_last_boot.txt
```

#### 2 - Parsing Log Files with awk

- awk is a powerful text-processing language used for data extraction and reporting. It is particularly useful for parsing log files and extratcting specific fields or patterns.

```sh
nano /var/log/syslog
awk '{print $1, $2, $3}' /var/log/syslog
awk '/root/ {print $0}' /var/log/syslog
awk '/root/ {count++} END {print count}' /var/log/auth.log
awk '/failed/ {count++} END {print count}' /var/log/auth.log
awk '/session opened/ {user[$11]++} END {for (u in user) print u, user[u]}' /var/log/auth.log
awk '/root/' /var/log/syslog > warning_logs.txt
nano warning_logs.txt
```

#### 3 - Monitoring Logs in Real-Time with tail

- tail is a command-line utility used to display the end of a text file or stream. It is commonly used to monitor log files in real-time.

```sh
tail /var/log/syslog
tail -f /var/log/syslog | grep --color=auto "error"
tail -f /var/log/syslog /var/log/auth.log
tail -n 50 -f /var/log/syslog
```

#### 4 - Summarizing Logs with logwatch

- logwatch is a log analysis tool that generates detailed summaries of system logs. It provides insights into system activity and potential issues by aggregation and summarizing log entries.

```sh
sudo apt-get install logwatch
logwatch --help
sudo logwatch --detail low --range today
```

#### 5 - Using Auditd to track System Events

- Use Auditd to set up and analyze audit rules for tracking specific system events.

```sh
sudo apt-get install auditd
sudo systemctl start auditd
sudo systemctl status auditd
sudo auditctl -w /bin/chmod -p x -k chmod_changes
sudo chmod 755 warning_logs.txt
sudo ausearch -k chmod_changes
```

#### Linux File System Analysis

- Linux File System Analysis is the process of examining the structure and content of a Linux file system to uncover, analyze, and interpret digital evidence.

- **Purpose:**

  - To recontruct events and user activities.
  - To identify security breaches, recover deleted data, and ensure compliance.
  - To gather evidence for legal investigations and incident response.

#### File System Analysis Activities

- File and Directory Analysis: File, Directory, Attributes(lsattr, chattr), Timestamp(stat), Hidden Files(ls -a || find / -name ".\*")
- Metadata Examination:
- File Content Analysis: Injection Analysis(grep || YARA), Malware Analysis (ClamAV, VirusTotal, strings), AES-256 Encrypted Data(AES-256)
- Advanced Activities: Data Recovery, Malware Detection Virus:

#### Linux File System

- A linux file system is a structured way to store and organize data on a disk drive or other storage devices.
- It manages how data is stored, retrieved, and organized on a storage medium.
- File System Types: Ext2, Ext3, Ext4, ReiserFS, XFS, Btrfs, etc.
- Structure: Superblock, inode table, data blocks, directories, and metadata.

#### Linux Directories

- /home/username
- /
- /etc/network/interfaces
- /etc/hosts
- /etc/passwd
- /etc/shadow
- /var/log
- /var/www

#### Tools

- **ls** - List directory contents
- **stat** - Display file or file system status
- **find** - Search for files in a directory hierarchy
- **grep** - Search through text
- **file** - Determine file type
- **df** - Report file system disk space usage
- **du** - Estimate file space usage
- **mount** - Mount and unmount file systems

#### 1 - Listing and Understanding Directory Contents

```sh
ls -l /home
ls -la /home
```

#### 2 - Analyzing File Metadata

```sh
stat /home/username/file.txt
file /home/username/file.txt
find /home -name "*.txt"
find /home -empty
find /home -type f -size +100M
find /home -type f -mtime -7
find /home -type f -atime -7
find /home -type f -ctime -7
```

#### 3 - Disk Usage Analysis

```sh
df -h
du -sh /home/username
du -ah /home/username
```

#### 4 - Searching and Filtering File Contents

```sh
echo "This is a test file for malware analysis." > test.exe
grep "malware" *.exe
grep -r "malware"
grep -c "malware" *.exe
```
